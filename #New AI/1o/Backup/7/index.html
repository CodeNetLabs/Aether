<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Szymdows AI</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: white;
      color: black;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }
    header {
      background-color: white;
      padding: 1rem 2rem;
      color: black;
      font-size: 1.5rem;
      border-bottom: 1px solid grey;
      position: sticky;
      top: 0;
      z-index: 1;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .header-subtext {
      font-size: 0.9rem;
      color: grey;
    }
    .sidebar {
      width: 180px;
      background-color: #d3d3d3;
      border-right: 1px solid #ccc;
      overflow-y: auto;
      padding: 1rem;
      display: flex;
      flex-direction: column;
    }
    .sidebar h2 {
      font-size: 1.2rem;
      margin-top: 0;
      position: sticky;
      top: 0;
      background-color: #d3d3d3;
      z-index: 1;
      padding-bottom: 0.5rem;
    }
    .history-item {
      background-color: #b0b0b0;
      padding: 0.5rem;
      margin-bottom: 0.5rem;
      border-radius: 5px;
      font-size: 0.9rem;
      color: black;
    }
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .chat-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 1rem;
      overflow: hidden;
    }
    .chat-log {
      flex: 1;
      overflow-y: auto;
      border: 1px solid #ccc;
      padding: 1rem;
      background-color: white;
      border-radius: 5px;
      margin-bottom: 0.5rem;
      color: black;
    }
    .chat-entry {
      margin-bottom: 1rem;
      opacity: 0;
      animation: fadeIn 0.5s forwards;
      white-space: pre-wrap;
    }
    @keyframes fadeIn {
      to {
        opacity: 1;
      }
    }
    .chat-entry.user {
      color: black;
    }
    .chat-entry.ai {
      color: grey;
    }
    .input-container {
      display: flex;
      padding: 0.5rem 0;
      position: sticky;
      bottom: 0;
      background: white;
      border-top: 1px solid #ccc;
    }
    input[type="text"] {
      flex: 1;
      padding: 0.5rem;
      border-radius: 5px;
      border: 1px solid grey;
      margin-right: 0.5rem;
    }
    button {
      background-color: grey;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
  <!-- math.js library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.1/math.min.js"></script>
</head>
<body>
  <div class="sidebar" style="height: 100vh;">
    <h2>History</h2>
    <div id="history" style="flex: 1; overflow-y: auto;"></div>
  </div>
  <div class="main-content">
    <header>
      <span>Szymdows AI</span>
      <span class="header-subtext">A specialized model for mathematics, arithmetic, and facts.</span>
    </header>
    <div class="chat-container">
      <div class="chat-log" id="chat-log"></div>
      <div class="input-container">
        <input type="text" id="user-input" placeholder="Ask something about a topic..." autocomplete="off" />
        <button onclick="askWiki()">Ask</button>
      </div>
    </div>
  </div>

  <script>
    const filters = [
      "What is", "What is the", "What does", "What happens when", "What are the", "What do you know about",
      "What causes", "What makes", "What kind of", "What would happen if", "How does", "How do", "How can",
      "How is", "How are the", "How does it affect", "How do you know", "How might", "How long does it take to",
      "How often does", "Why is", "Why does", "Why do", "Why can't", "Why should we", "Why did",
      "Why would someone", "Why does it matter if", "Why are there", "Why might", "When did", "When is",
      "When was the last time", "When do", "When should we", "When will", "When can", "When does it become",
      "When was", "When have you seen", "Where is", "Where can", "Where did", "Where does it come from",
      "Where do we find", "Where should we go to", "Where was the first", "Where are the most",
      "Where in the world is", "Where would you look for"
    ];

    function createSummary(text) {
      return text.length > 50 ? text.slice(0, 50) + '...' : text;
    }

    function welcomeMessage() {
      appendMessage('ai', 'Welcome to Szymdows AI! ðŸ˜Š I can help you with many things and problems, but I work best with 1-4 word answers!');
    }

    function cleanQuery(input) {
      let lowered = input.trim();
      for (const phrase of filters) {
        const pattern = new RegExp(`^${phrase}`, 'i');
        if (pattern.test(lowered)) {
          lowered = lowered.replace(pattern, '').trim();
          break;
        }
      }
      return lowered;
    }

    function isMathExpression(input) {
      // Basic heuristic to detect math expressions - numbers and math symbols only
      // This will match digits, spaces, operators + - * / ^ parentheses and dots
      return /^[0-9+\-*/().^ %]+$/.test(input);
    }

    async function askWiki() {
      const inputElem = document.getElementById('user-input');
      const rawQuery = inputElem.value.trim();
      if (!rawQuery) return;

      appendMessage('user', rawQuery);

      if (isMathExpression(rawQuery)) {
        try {
          // Evaluate expression with math.js
          const result = math.evaluate(rawQuery);
          appendMessage('ai', `The result is: ${result}`);
        } catch (error) {
          appendMessage('ai', `I couldn't calculate that. ðŸ˜”`);
        }
        inputElem.value = '';
        return;
      }

      const query = cleanQuery(rawQuery);
      if (!query) {
        appendMessage('ai', "I couldn't find anything in my database. ðŸ˜” But try to refrase your input or try something else. (Remember that I am still in training!)");
        inputElem.value = '';
        return;
      }

      try {
        const response = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(query)}`);
        const data = await response.json();

        let reply = "I couldn't find anything in my database. ðŸ˜” But try to refrase your input or try something else. (Remember that I am still in training!)";
        if (data.extract) {
          const paragraphs = data.extract.split('\n');
          reply = paragraphs.slice(0, 2).join('\n\n');
        }

        appendMessage('ai', reply);
        appendHistoryItem(query, reply);
      } catch {
        appendMessage('ai', "I couldn't retrieve information. Please try again later.");
      }

      inputElem.value = '';
    }

    function appendMessage(sender, text) {
      const log = document.getElementById('chat-log');
      const entry = document.createElement('div');
      entry.className = 'chat-entry ' + sender;
      entry.textContent = `${sender === 'user' ? 'You' : 'Szymdows AI'}: ${text}`;
      log.appendChild(entry);
      log.scrollTop = log.scrollHeight;
    }

    function appendHistoryItem(query, reply) {
      const history = document.getElementById('history');
      const item = document.createElement('div');
      item.className = 'history-item';
      item.textContent = `${query}: ${createSummary(reply)}`;
      history.prepend(item);
    }

    document.getElementById('user-input').addEventListener('keydown', function (event) {
      if (event.key === 'Enter') {
        event.preventDefault();
        askWiki();
      }
    });

    window.onload = welcomeMessage;
  </script>
</body>
</html>
